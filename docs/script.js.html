<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: script.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: script.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>let cards = document.getElementById('cards')
let $template = document.getElementById('card-template').content
let $fragment = document.createDocumentFragment()
let formulario = document.getElementById('busqueda')
let urlBase = 'https://evening-taiga-78339.herokuapp.com'
let ubicacionArreglo = window.location.pathname.split('/')

/**
 * Esta función formatea el path para obtener solamente el slug.
 * @param {Array} arr El arreglo conformado por el pathname guardado en la variable ubicacionArreglo.
 * @returns {String} El slug,
 */
let formateador = (arr) => {
  let lastItem = arr[arr.length-1]
  if (!lastItem) return '/'
  return (`/${lastItem}`)
}
const ubicacion = formateador(ubicacionArreglo)
console.log('ubicacion: ', ubicacion)

/* Renderizado para cada ruta */
/* Manipulación del DOM directa */

window.addEventListener('load', function (event) {
  cards.innerHTML = `
  &lt;div class="d-flex justify-content-center">
      &lt;div class="spinner-border" role="status">
        &lt;span class="visually-hidden">Cargando...&lt;/span>
      &lt;/div>
  &lt;/div>
  `
  const filtrado = async (productoDeseado) => {
    //console.log(productoDeseado)
    const allData = await axios.get(`${urlBase}/data${productoDeseado}`)
    console.log('data por evento load: ', allData.data)
    let allElements = ''
    allData.data.forEach(e => {
      const url = e.url_image ? e.url_image : '#'
      let price = new Intl.NumberFormat('es-CL', {
        style: 'currency',
        currency: 'CLP'
      })
      allElements += `
        &lt;div class="col">
          &lt;div class="card m-2" style="width: 18rem;">
            &lt;img src='${url}' class='img-fluid card-img-top' alt='${e.name}'>
            &lt;div class="card-body">
              &lt;h5 class="card-title">${e.name}&lt;/h5>
              &lt;p class="card-text">${price.format(e.price)}&lt;/p>
            &lt;/div>
          &lt;/div>
        &lt;/div>
      `
    });
    cards.innerHTML = allElements
  }
  filtrado(ubicacion)
});

/* Búsqueda */
/* Manipulación del DOM optimizada utilizando templates y fragments */

document.addEventListener('submit', async (e) => {
  e.preventDefault()
  let productoABuscar = e.target[0].value
  console.log('producto a buscar: ', productoABuscar)
  try {
    cards.innerHTML = `
      &lt;div class="d-flex justify-content-center">
        &lt;div class="spinner-border" role="status">
          &lt;span class="visually-hidden">Cargando...&lt;/span>
        &lt;/div>
      &lt;/div>
        `
    let query = { producto: productoABuscar.toLowerCase() }
    //console.log(query)
    let api = `${urlBase}/search`
    let res = await axios.get(api, { params: query })
    console.log('data por evento submit: ', res)
    let resData = res.data
    //console.log(api, res)
    console.log('resData: ', resData)

    if (resData == 'No results' || resData.length == 0) {
      cards.innerHTML = `&lt;h2>Sin resultados&lt;/h2>`
    } else {
      resData.forEach(e => {
        //console.log(e)
        const url = e.url_image ? e.url_image : '#'
        let price = new Intl.NumberFormat('es-CL', {
          style: 'currency',
          currency: 'CLP'
        })
        $template.querySelector('img').src = url;
        $template.querySelector('img').alt = e.name;
        $template.querySelector('h5').textContent = e.name;
        $template.querySelector('p').textContent = price.format(e.price);

        let $clone = document.importNode($template, true);
        $fragment.appendChild($clone);
      });

      cards.innerHTML = '';
      cards.appendChild($fragment)
    }
  } catch (err) {
    //console.log(err)
    cards.innerHTML = `&lt;p>Ocurrió un error&lt;/p>`
  }
})</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#formateador">formateador</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Tue Sep 06 2022 04:58:57 GMT-0300 (hora de verano de Chile)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
